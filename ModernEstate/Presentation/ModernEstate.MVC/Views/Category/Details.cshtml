@using ModernEstate.Application.ViewModels.Properties
@using ModernEstate.Domain.Entities
@model PropertyVM

<section class="section-full section-full-mod-1 text-left">
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<h1>Property Catalog</h1>
				<p></p>
				<ol class="breadcrumb">
					<li>
						<a href="index.html">Home</a>
					</li>
					<li>
						<a href="#">Property Catalog</a>
					</li>
					<li class="active">Property Catalog Grid</li>
				</ol>
			</div>
		</div>
	</div>
</section>
<!--Section Find your home-->
<section class="section-sm section-bottom-0 undefined text-left">
	<div class="container position-margin-top position-margin-top-mod-1">
		<div class="search-form-wrap bg-white container-shadow">
			<h3>Find Your Home</h3>
			<form action="#" name="search-form" class="form-variant-1">
				<div class="form-group">
					<label for="keyword" class="form-label">Keyword</label>
					<input id="keyword" type="text" name="keyword" placeholder="Any" class="form-control">
				</div>
				<div class="form-group">
					<label for="select-search-1" class="form-label">Location</label>
					<select id="select-search-1" data-minimum-results-for-search="Infinity" class="form-control select-filter">
						@foreach (GetPropertyVM propertyVM in Model.Property)
						{
							<option value="@propertyVM.Location">@propertyVM.Location</option>
						}
					</select>
				</div>
				<div class="form-group">
					<label for="select-search-2" class="form-label">Property Status</label>
					<select id="select-search-2" data-minimum-results-for-search="Infinity" class="form-control select-filter">

					</select>
				</div>
				<div class="form-group">
					<label for="select-search-3" class="form-label">Property Type</label>
					<select id="select-search-3" data-minimum-results-for-search="Infinity" class="form-control select-filter">

					</select>
				</div>
				<div class="form-group width-1">
					<span>
						Price (USD)
						<br>
					</span>
					<div class="form-inline-flex-xs">
						<input id="range-1" type="text" name="range-2" class="rd-range-input-value rd-range-input-value-1 form-control" placeholder="100">
						<span class="text-abbey dash">—</span>
						<input id="range-2" type="text" name="range-3" class="rd-range-input-value rd-range-input-value-2 form-control" placeholder="15000">
					</div>
					<div data-min="100" data-max="10000" data-start="[600, 9500]" data-step="50" data-tooltip="true" data-min-diff="100" data-input=".rd-range-input-value-1" data-input-2=".rd-range-input-value-2" class="rd-range"></div>
				</div>
				<div class="form-group width-1">
					<span>
						Area (Sq Ft)
						<br>
					</span>
					<div class="form-inline-flex-xs">
						<input id="range-3" type="text" name="range-2" class="rd-range-input-value rd-range-input-value-3 form-control" placeholder="100">
						<span class="text-abbey dash">—</span>
						<input id="range-4" type="text" name="range-3" class="rd-range-input-value rd-range-input-value-4 form-control" placeholder="10,000">
					</div>
					<div data-min="500" data-max="22000" data-start="[2000, 20000]" data-step="50" data-tooltip="true" data-min-diff="500" data-input=".rd-range-input-value-3" data-input-2=".rd-range-input-value-4" class="rd-range"></div>
				</div>
				<div class="form-group width-2">
					<label for="select-search-7" class="form-label">Min Beds</label>
					<select id="select-search-7" data-minimum-results-for-search="Infinity" class="form-control select-filter">
						<option value="Any" selected="selected">Any</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
					</select>
				</div>
				<div class="form-group width-2">
					<label for="select-search-8" class="form-label">Min Baths</label>
					<select id="select-search-8" data-minimum-results-for-search="Infinity" class="form-control select-filter">
						<option value="Any" selected="selected">Any</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
					</select>
				</div>
				<button class="btn btn-sm btn-sushi btn-min-width-sm">Search</button>
				<div class="features">
					<a href="" onclick="return false" class="btn-features">
						<span></span>Look for certain features
					</a>
					<ul class="checkbox-list list-inline">
						<li>
							<label class="checkbox-inline">
								<input name="input-group-radio" value="checkbox-1" type="checkbox" checked="checked">
								<span>Central Heating (7)</span>
							</label>
						</li>
						<li>
							<label class="checkbox-inline">
								<input name="input-group-radio" value="checkbox-2" type="checkbox">
								<span>Lawn (6)</span>
							</label>
						</li>
						<li>
							<label class="checkbox-inline">
								<input name="input-group-radio" value="checkbox-3" type="checkbox">
								<span>Marble Floors (8)</span>
							</label>
						</li>
						<li>
							<label class="checkbox-inline">
								<input name="input-group-radio" value="checkbox-4" type="checkbox">
								<span>Fire Alarm (5)</span>
							</label>
						</li>
						<li>
							<label class="checkbox-inline">
								<input name="input-group-radio" value="checkbox-5" type="checkbox">
								<span>Home Theater (3)</span>
							</label>
						</li>
						<li>
							<label class="checkbox-inline">
								<input name="input-group-radio" value="checkbox-6" type="checkbox">
								<span>Hurricane Shutters (1)</span>
							</label>
						</li>
					</ul>
				</div>
			</form>
		</div>
	</div>
</section>
<!-- Section Catalog-->
<section class="section-md section-mod-1 text-left">
	<div class="container">
		<div class="row">
			<div class="col-xs-12 col-sm-3 pull-xs-left text-center text-sm-left">
				<!-- RD SelectMenu-->
				<div class="sort-input">
					<div class="form-group form-group-mod-1">
						<label for="sort-1" class="form-label">Sorting</label>
						<!--Select 2-->
						<select id="sort-1" data-minimum-results-for-search="Infinity" class="form-control select-filter">
							<option value="By Price" selected="selected">By Price</option>
							<option value="By Date">By Date</option>
							<option value="By Square">By Square</option>
							<option value="By Location">By Location</option>
						</select>
					</div>
				</div>
			</div>
			</div>
		</div>

		<section class="section-md text-center text-sm-left">
	<div class="container">
		<h2>Popular Properties</h2>
		<hr>
		<div class="row clearleft-custom" id="property-container">
			@foreach (var propertyVM in Model.Property)
			{
				<div class="col-xs-12 col-sm-6 col-md-4">
					<div class="thumbnail thumbnail-3">
						<a asp-controller="SingleProperty" asp-action="Details" asp-route-Id="@propertyVM.Id" class="img-link">
							<img src="~/assets/images/@propertyVM.Photo" alt="" class="img-fluid" style="width: 100%; height: auto;">
						</a>
						<div class="caption">
							<h4>
								<a asp-controller="SingleProperty" asp-action="Details" asp-route-Id="@propertyVM.Id" class="text-sushi">@propertyVM.Location</a>
							</h4>
							<span class="thumbnail-price h5">
								$@propertyVM.Price/
								<span class="mon text-regular">month</span>
							</span>
							<ul class="describe-1">
								<li><span class="icon icon-sm icon-primary hotel-icon-10"></span>@propertyVM.BathroomCount bathrooms</li>
								<li><span class="icon icon-sm icon-primary hotel-icon-05"></span>@propertyVM.BedroomCount bedrooms</li>
								<li><span class="icon icon-sm icon-primary hotel-icon-26"></span>@propertyVM.GarageCount garages</li>
								<li><span class="icon icon-sm icon-primary hotel-icon-30"></span>@propertyVM.Area sq ft</li>
							</ul>
							@{
								string sentence = propertyVM.Description;
								string description = sentence.Substring(0, sentence.IndexOf(".") + 1);
							}
							<p>@description</p>
						</div>
					</div>
				</div>
			}
		</div>

		<!-- AJAX Pagination -->
		@if (Model.TotalPage > 1)
		{
			<div class="col-xs-12 text-center text-sm-left">
				<ul class="pagination" id="pagination-container">
					<li class="@(Model.CurrentPage <= 1 ? "disabled" : "")">
						<a href="#" class="page-link" data-page="@(Model.CurrentPage - 1)" data-category="@Model.Categories.Id">
							<span class="fa-chevron-left"></span>
						</a>
					</li>
					@for (int i = 1; i <= Model.TotalPage; i++)
					{
						<li class="@(Model.CurrentPage == i ? "active" : "")">
								<a href="#" class="page-link" data-page="@i" data-category="@Model.Categories.Id">@i</a>
						</li>
					}
					<li class="@(Model.CurrentPage == Model.TotalPage ? "disabled" : "")">
							<a href="#" class="page-link" data-page="@(Model.CurrentPage + 1)" data-category="@Model.Categories.Id">
							<span class="fa-chevron-right"></span>
						</a>
					</li>
				</ul>
			</div>
		}
	</div>
</section>


		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script>
			$(document).ready(function () {
				$(document).on("click", ".page-link", function (e) {
					e.preventDefault();

					let page = $(this).data("page");
					let categoryId = $(this).data("category");

					if (!page || $(this).parent().hasClass("disabled") || $(this).parent().hasClass("active")) {
						return;
					}

					$.ajax({
						url: "/Category/Details?Id=" + categoryId + "&page=" + page,
						type: "GET",
						beforeSend: function () {
							$("#property-container").css("opacity", "0.5"); 
						},
						success: function (data) {
							let newHtml = $(data).find("#property-container").html(); 
							let newPagination = $(data).find("#pagination-container").html(); 
							$("#property-container").html(newHtml);
							$("#pagination-container").html(newPagination);
						},
						complete: function () {
							$("#property-container").css("opacity", "1");
						},
						error: function () {
							alert("Something went wrong. Please try again.");
						}
					});
				});
			});
		</script>
</section>